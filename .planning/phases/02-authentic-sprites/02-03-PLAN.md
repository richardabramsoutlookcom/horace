---
phase: 02-authentic-sprites
plan: 03
type: execute
wave: 1
depends_on: []
files_modified: [main.js]
autonomous: true

must_haves:
  truths:
    - "Flag gates show red pole on left, blue pole on right"
    - "Gates have visible flag/marker at top"
    - "Trees have triangular green canopy and trunk"
    - "Ski slope has authentic Spectrum visual style"
  artifacts:
    - path: "main.js"
      provides: "Gate and tree rendering in drawSki()"
      contains: "drawGate"
  key_links:
    - from: "gate object"
      to: "drawGate helper"
      via: "forEach in drawSki"
      pattern: "drawGate"
---

<objective>
Create authentic ZX Spectrum-style ski slope sprites including flag gates and trees.

Purpose: Replace current simple shapes with sprites matching the original Horace Goes Skiing ski slope visuals - distinctive red/blue slalom gates and blocky trees.
Output: Updated gate and tree rendering in drawSki() with authentic Spectrum style.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-visual-foundation/01-01-SUMMARY.md
@main.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create drawGate helper for authentic flag poles</name>
  <files>main.js</files>
  <action>
Add a drawGate(gate, cameraY) helper function for authentic Spectrum-style slalom gates.

Original Horace Goes Skiing gates:
- Left pole: RED with small flag/marker at top
- Right pole: BLUE with small flag/marker at top
- Poles are thin vertical rectangles
- Flags are small rectangles or triangles extending from pole top
- When passed, gates turn GREEN

Function structure:
```javascript
function drawGate(gate, cameraY) {
  const y = gate.y - cameraY;
  if (y < -20 || y > LOGICAL_H + 20) return;

  // Color selection
  const leftColorName = gate.passed ? 'BRIGHT_GREEN' : 'BRIGHT_RED';
  const rightColorName = gate.passed ? 'BRIGHT_GREEN' : 'BRIGHT_BLUE';

  // Left pole with flag
  ctx.fillStyle = ZX_PALETTE[leftColorName];
  // Pole (thin vertical)
  ctx.fillRect(gate.left - 1, y, 3, 18);
  // Flag at top (extends right from pole)
  ctx.fillRect(gate.left + 2, y, 6, 4);
  // Track attribute
  setAttr(gate.left, y, leftColorName, 'BRIGHT_WHITE');

  // Right pole with flag
  ctx.fillStyle = ZX_PALETTE[rightColorName];
  // Pole (thin vertical)
  ctx.fillRect(gate.right - 1, y, 3, 18);
  // Flag at top (extends left from pole)
  ctx.fillRect(gate.right - 7, y, 6, 4);
  // Track attribute
  setAttr(gate.right, y, rightColorName, 'BRIGHT_WHITE');
}
```

The flags should be visible markers that help players identify the gates quickly.
  </action>
  <verify>drawGate function exists in main.js</verify>
  <done>drawGate helper function created with authentic flag pole rendering</done>
</task>

<task type="auto">
  <name>Task 2: Create drawTree helper and update drawSki</name>
  <files>main.js</files>
  <action>
Add a drawTree(obstacle, cameraY) helper function and update drawSki() to use both helpers.

Authentic Spectrum trees:
- Triangular green canopy (simple triangle, not curved)
- Red or brown trunk (ZX Spectrum had no brown, use RED)
- Blocky appearance - no smooth edges

Function structure:
```javascript
function drawTree(obstacle, cameraY) {
  const y = obstacle.y - cameraY;
  if (y < -20 || y > LOGICAL_H + 20) return;

  const x = obstacle.x;
  const size = obstacle.r; // Use radius as size reference

  // Green triangular canopy
  ctx.fillStyle = ZX_PALETTE.GREEN;
  // Draw as stacked rectangles for blocky look (instead of path)
  const canopyHeight = size * 1.5;
  for (let row = 0; row < canopyHeight; row++) {
    const width = Math.floor((canopyHeight - row) * 1.2);
    ctx.fillRect(x - width/2, y - canopyHeight + row, width, 1);
  }

  // Red trunk
  ctx.fillStyle = ZX_PALETTE.RED;
  const trunkW = Math.max(2, Math.floor(size * 0.3));
  const trunkH = Math.floor(size * 0.5);
  ctx.fillRect(x - trunkW/2, y, trunkW, trunkH);

  // Track in attribute system
  setAttr(x, y - size, 'GREEN', 'BRIGHT_WHITE');
  setAttr(x, y, 'RED', 'BRIGHT_WHITE');
}
```

Update drawSki() to use both helpers:

Replace the gates.forEach block with:
```javascript
gates.forEach((gate) => {
  drawGate(gate, cameraY);
});
```

Replace the obstacles.forEach block with:
```javascript
obstacles.forEach((obstacle) => {
  drawTree(obstacle, cameraY);
});
```

This makes drawSki() much cleaner and the sprite code reusable.
  </action>
  <verify>Run game, ski slope shows authentic flag poles (red left, blue right with flags) and blocky trees</verify>
  <done>drawSki() uses helper functions for authentic gate and tree rendering</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] drawGate() helper function exists
- [ ] drawTree() helper function exists
- [ ] drawSki() uses both helpers
- [ ] Gates show red pole left, blue pole right with flags
- [ ] Passed gates turn green
- [ ] Trees appear as blocky triangular shapes
- [ ] No JavaScript errors in browser console
</verification>

<success_criteria>
- All tasks completed
- Gates are visually distinctive (red/blue with flags)
- Trees have authentic blocky Spectrum appearance
- All sprites use only ZX_PALETTE colors
- Attribute system tracks colors correctly
</success_criteria>

<output>
After completion, create `.planning/phases/02-authentic-sprites/02-03-SUMMARY.md`
</output>
