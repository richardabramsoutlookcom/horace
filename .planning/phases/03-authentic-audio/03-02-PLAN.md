---
phase: 03-authentic-audio
plan: 02
type: execute
wave: 2
depends_on: ["03-01"]
files_modified: [main.js]
autonomous: false

must_haves:
  truths:
    - "Gate pass makes a quick, high-pitched beep"
    - "Gate miss makes a lower, warning-style buzz distinct from crash"
    - "Collision sounds (car and tree) are harsh crash sounds"
    - "Ski jump sound function exists (ready for Phase 4 wiring)"
  artifacts:
    - path: "main.js"
      provides: "Complete set of authentic sound effects"
      contains: "playGateMiss|playSkiJump"
  key_links:
    - from: "loseLife function"
      to: "appropriate sound function"
      via: "different sounds for gate miss vs obstacle crash"
      pattern: "playGateMiss|playTreeCrash"
---

<objective>
Add missing authentic sound effects and differentiate collision sounds.

Purpose: The original game had distinct sounds for different events. Gate miss was a warning, not a crash. Ski jump had a unique ascending "bizarre" sound.
Output: Complete sound effect library matching original ZX Spectrum beeper style.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
@~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@.planning/phases/03-authentic-audio/03-01-SUMMARY.md — Audio infrastructure from Plan 01
@main.js — Audio functions and game logic
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add gate miss warning sound</name>
  <files>main.js</files>
  <action>
    Create a distinct gate miss sound and wire it into gameplay:

    1. Create `playGateMiss()` function:
       - Use the single-channel pattern from Plan 01
       - Lower frequency than gate pass (around 200-300Hz)
       - Longer duration (0.15-0.2s) to feel like a warning
       - Could use two quick descending tones for "uh-oh" feel
       - Example: 300Hz for 0.08s, then 200Hz for 0.1s

    2. Modify the gate miss handling in `updateSki()`:
       - Currently at line ~529: `loseLife("Missed gate!")`
       - BEFORE calling loseLife, play the gate miss sound
       - Or: create a separate code path that doesn't use loseLife for gate miss
         (gate miss in original game didn't lose a life, just score penalty)

       NOTE: Check if gate miss should actually lose a life. Original game behavior:
       - Missing a gate caused score penalty
       - NOT a life loss (that was tree/crash only)
       - If current code calls loseLife() for gate miss, this may be a gameplay bug
         (defer gameplay fix to Phase 4, but use distinct sound now)

    3. For now: Add playGateMiss() call before loseLife("Missed gate!") so at least
       the sound is correct even if gameplay needs Phase 4 tuning.
  </action>
  <verify>Miss a gate in ski mode - should hear warning buzz, not crash sound</verify>
  <done>playGateMiss function exists, called when gate is missed, sounds different from crash</done>
</task>

<task type="auto">
  <name>Task 2: Add ski jump sound and differentiate crash sounds</name>
  <files>main.js</files>
  <action>
    Complete the sound library:

    1. Create `playSkiJump()` function:
       - The original was described as a "bizarre jumping sound"
       - Ascending frequency sweep (like going up)
       - Start around 200Hz, sweep up to 800-1000Hz over 0.3s
       - Use exponentialRampToValueAtTime for the sweep
       - Use square wave of course
       - This function won't be called yet (ski jump mechanic is Phase 4)
         but the sound should be ready

    2. Optionally differentiate crash sounds:
       - `playCarHit()` - already exists, descending crash
       - `playTreeCrash()` - could be same as playCarHit or slightly different
         (Original may have used same sound for all crashes)

       If keeping same: just document that playCarHit is used for both
       If differentiating: create playTreeCrash with slightly different timing

    3. Document sound design decisions in code comments:
       ```javascript
       // ZX Spectrum beeper sounds - frequencies approximated from original
       // Gate pass: quick high beep (success)
       // Gate miss: lower warning buzz (penalty but continue)
       // Crash: descending harsh buzz (car/tree collision)
       // Ski jump: ascending sweep (lift-off - wired in Phase 4)
       ```
  </action>
  <verify>Check that playSkiJump function exists in code, uses square wave, has frequency sweep</verify>
  <done>playSkiJump function exists ready for Phase 4 wiring, crash sounds documented</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete authentic ZX Spectrum audio system:
    - Single-channel (one sound at a time)
    - All square wave
    - Gate pass: high quick beep
    - Gate miss: lower warning buzz
    - Crash: descending harsh buzz
    - Ski equipped: ascending melody
    - Ski jump: ascending sweep (function ready, not wired yet)
  </what-built>
  <how-to-verify>
    1. Run: Open the game in browser (or npm run dev if applicable)
    2. Start a game (any control mode)

    ROAD MODE:
    3. Walk toward traffic - get hit by a car
       - Should hear: descending harsh buzz
    4. After respawn, walk up/down
       - Should hear: quiet movement beeps
    5. Reach ski shop
       - Should hear: ascending melody (ski equipped)

    SKI MODE:
    6. Miss a gate (go outside the flags)
       - Should hear: warning buzz (different from crash!)
    7. Hit a tree
       - Should hear: crash sound (similar to car hit)
    8. Pass through a gate
       - Should hear: quick high beep

    AUDIO QUALITY:
    9. Listen for any smooth/sine-wave sounds - all should be harsh/buzzy
    10. Try triggering sounds rapidly - new should cut off old
  </how-to-verify>
  <resume-signal>Type "approved" if all sounds feel authentic, or describe which sounds need adjustment</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] playGateMiss function exists and is called on gate miss
- [ ] playSkiJump function exists with ascending frequency sweep
- [ ] Gate miss plays different sound than crash
- [ ] All sounds use square wave
- [ ] User approved audio in checkpoint
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No audio-related errors in console
- User approved audio quality in checkpoint
- All requirement sounds exist (AUD-01 through AUD-06)
</success_criteria>

<output>
After completion, create `.planning/phases/03-authentic-audio/03-02-SUMMARY.md`
</output>
