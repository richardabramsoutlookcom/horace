---
phase: 01-visual-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - main.js
  - style.css
autonomous: true

must_haves:
  truths:
    - "Canvas renders at 256x192 native resolution"
    - "Display scales using integer multiples for crisp pixels"
    - "All on-screen colors match exact ZX Spectrum 15-color palette"
  artifacts:
    - path: "main.js"
      provides: "ZX Spectrum resolution and palette"
      contains: "LOGICAL_W = 256"
    - path: "main.js"
      provides: "ZX_PALETTE constant"
      contains: "ZX_PALETTE"
  key_links:
    - from: "draw()"
      to: "integer scaling"
      via: "Math.floor(scale)"
      pattern: "Math\\.floor.*scale"
    - from: "ctx.fillStyle"
      to: "ZX_PALETTE"
      via: "palette color reference"
      pattern: "ZX_PALETTE\\["
---

<objective>
Establish authentic ZX Spectrum visual foundation with correct resolution and palette.

Purpose: Transform the game from modern 360×640 portrait to authentic 256×192 landscape with exact ZX Spectrum colors. This is the foundation for all subsequent visual authenticity work.

Output: Game renders at ZX Spectrum resolution with integer pixel scaling and authentic palette colors.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/codebase/ARCHITECTURE.md
@.planning/codebase/CONCERNS.md

@main.js
@style.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update resolution to 256×192 with integer scaling</name>
  <files>main.js</files>
  <action>
    1. Change LOGICAL_W from 360 to 256
    2. Change LOGICAL_H from 640 to 192
    3. Update draw() function to use INTEGER scaling:
       - Calculate max integer scale that fits: Math.floor(Math.min(window.innerWidth / LOGICAL_W, window.innerHeight / LOGICAL_H))
       - Ensure minimum scale of 1
       - Center the canvas with the integer-scaled dimensions
    4. Update all layout constants for the new aspect ratio:
       - roadLayout: top ~20, bottom ~160 (proportional for 192 height)
       - shopRect: proportional for 256 width, ~50 height for top area
       - pavementRect: bottom portion
       - horace starting position: center of new width, near bottom
    5. Update slopeLength for proportional ski run
    6. Update entity sizes (vehicles, gates, obstacles) to be proportional

    IMPORTANT: The game changes from portrait (9:16) to landscape (4:3). All Y-positions need recalculation. Think in terms of proportions, not absolute pixels.

    Integer scaling ensures crisp pixels: 256×192 × 2 = 512×384, × 3 = 768×576, etc.
  </action>
  <verify>
    Open index.html in browser, check:
    - Canvas is landscape (wider than tall)
    - Pixels are crisp (no blurring between pixels)
    - Game elements appear proportionally correct
    - Console shows no errors
  </verify>
  <done>
    - LOGICAL_W = 256, LOGICAL_H = 192
    - Integer scaling applied in draw()
    - All layout constants updated for new resolution
    - Game renders without errors
  </done>
</task>

<task type="auto">
  <name>Task 2: Add ZX Spectrum palette and convert all colors</name>
  <files>main.js</files>
  <action>
    1. Add ZX_PALETTE constant after LOGICAL_W/H definition:
       ```javascript
       // ZX Spectrum 15-color palette (8 colors × 2 brightness, minus duplicate black)
       const ZX_PALETTE = {
         // Normal brightness (BRIGHT 0)
         BLACK:    '#000000',
         BLUE:     '#0000CD',
         RED:      '#CD0000',
         MAGENTA:  '#CD00CD',
         GREEN:    '#00CD00',
         CYAN:     '#00CDCD',
         YELLOW:   '#CDCD00',
         WHITE:    '#CDCDCD',
         // Bright colors (BRIGHT 1)
         BRIGHT_BLACK:   '#000000',  // Same as BLACK
         BRIGHT_BLUE:    '#0000FF',
         BRIGHT_RED:     '#FF0000',
         BRIGHT_MAGENTA: '#FF00FF',
         BRIGHT_GREEN:   '#00FF00',
         BRIGHT_CYAN:    '#00FFFF',
         BRIGHT_YELLOW:  '#FFFF00',
         BRIGHT_WHITE:   '#FFFFFF',
       };
       ```

    2. Update drawRoad() colors:
       - Background: ZX_PALETTE.BLACK
       - Top pavement: ZX_PALETTE.WHITE (or CYAN for contrast)
       - Shop building: ZX_PALETTE.BLUE
       - Shop roof: ZX_PALETTE.RED
       - Shop sign: ZX_PALETTE.BRIGHT_YELLOW
       - Road surface: ZX_PALETTE.BLACK (roads were black on Spectrum)
       - Lane markings: ZX_PALETTE.WHITE
       - Bottom pavement: ZX_PALETTE.WHITE (or CYAN)
       - Vehicles: Mix of ZX_PALETTE colors (YELLOW/RED bodies, CYAN/MAGENTA accents)
       - Wheels: ZX_PALETTE.BLACK

    3. Update drawSki() colors:
       - Snow/background: ZX_PALETTE.BRIGHT_WHITE
       - Snow texture lines: ZX_PALETTE.CYAN
       - Left gate pole: ZX_PALETTE.BRIGHT_RED
       - Right gate pole: ZX_PALETTE.BRIGHT_BLUE
       - Passed gate: ZX_PALETTE.BRIGHT_GREEN (both poles)
       - Trees: ZX_PALETTE.GREEN (canopy), ZX_PALETTE.RED or YELLOW (trunk)

    4. Update drawHorace() colors:
       - Body: ZX_PALETTE.BRIGHT_BLUE (or BRIGHT_GREEN when skiing)
       - Eyes: ZX_PALETTE.BRIGHT_WHITE
       - Skis: ZX_PALETTE.BRIGHT_WHITE

    5. Remove all non-palette hex colors (no #A0A0A0, #404040, #00AA00, etc.)

    IMPORTANT: Use ONLY colors from ZX_PALETTE. No arbitrary hex values.
  </action>
  <verify>
    Open index.html in browser, verify:
    - All colors are bright, saturated ZX Spectrum colors
    - No gray tones (Spectrum didn't have grays except white variations)
    - Colors match authentic ZX Spectrum appearance
    - Road mode and Ski mode both use correct palette
  </verify>
  <done>
    - ZX_PALETTE constant defined with all 15 colors
    - All fillStyle/strokeStyle use ZX_PALETTE references
    - No arbitrary hex color values remain
    - Visual appearance matches ZX Spectrum aesthetic
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] LOGICAL_W = 256, LOGICAL_H = 192
- [ ] Integer scaling visible (crisp pixels, no blur)
- [ ] ZX_PALETTE constant exists with correct colors
- [ ] All ctx.fillStyle/strokeStyle use ZX_PALETTE
- [ ] Game runs without JavaScript errors
- [ ] Both ROAD and SKI modes render correctly
- [ ] Horace visible and proportionally correct
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Game renders at 256×192 with integer scaling
- All colors from ZX Spectrum palette only
- No console errors
</success_criteria>

<output>
After completion, create `.planning/phases/01-visual-foundation/01-01-SUMMARY.md`
</output>
