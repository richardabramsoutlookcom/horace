---
phase: 04-gameplay-timing
plan: 02
type: execute
wave: 1
depends_on: []
files_modified: [main.js, index.html]
autonomous: true

must_haves:
  truths:
    - "Player starts with $40"
    - "Collision costs $10 ambulance fee"
    - "Ski rental costs $10"
    - "Player earns $10 bonus at every 1000-point boundary"
    - "HUD displays current money amount"
  artifacts:
    - path: "main.js"
      provides: "Money system with authentic economy"
      contains: "state.money"
  key_links:
    - from: "loseLife()"
      to: "state.money"
      via: "Deduct $10 ambulance fee"
    - from: "ski shop logic"
      to: "state.money"
      via: "Deduct $10 rental"
    - from: "score increment"
      to: "checkPointBonus()"
      via: "Award $10 at 1000-point boundaries"
---

<objective>
Implement authentic money system: $40 start, $10 fees/bonuses.

Purpose: Original game had economic pressure - collisions cost money, ski rental cost money, but passing score thresholds earned money back.
Output: Working money system with HUD display and all authentic costs/bonuses.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@main.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add money state and HUD display</name>
  <files>main.js</files>
  <action>
1. Add money to state object:
   ```javascript
   const state = {
     lives: 3,
     score: 0,
     money: 40,  // GAME-01: Start with $40
     // ... rest of state
   };
   ```

2. Add moneyEl reference at top:
   ```javascript
   const moneyEl = document.getElementById("money");
   ```

3. Update updateHUD() to display money:
   ```javascript
   function updateHUD() {
     scoreEl.textContent = `Score: ${state.score}`;
     livesEl.textContent = `Lives: ${state.lives}`;
     moneyEl.textContent = `$${state.money}`;  // New
     modeEl.textContent = `Mode: ${state.mode}`;
   }
   ```

4. Update resetGame() to reset money to 40:
   ```javascript
   function resetGame() {
     state.lives = 3;
     state.score = 0;
     state.money = 40;  // Reset to $40
     // ... rest of reset
   }
   ```

5. Add money element to index.html HUD:
   In index.html, modify the #hud div:
   ```html
   <div id="hud">
     <div id="score">Score: 0</div>
     <div id="money">$40</div>
     <div id="lives">Lives: 3</div>
     <div id="mode">Mode: ROAD</div>
   </div>
   ```
  </action>
  <verify>Game shows $40 at start, money displays in HUD</verify>
  <done>Money state exists and displays in HUD starting at $40</done>
</task>

<task type="auto">
  <name>Task 2: Implement money costs and bonuses</name>
  <files>main.js</files>
  <action>
1. GAME-02: Ambulance fee - modify loseLife() to deduct $10:
   ```javascript
   function loseLife(reason, playSound = true) {
     state.money -= 10;  // Ambulance fee
     state.lives -= 1;
     // ... rest of function
   }
   ```

2. GAME-03: Ski rental cost - modify ski shop logic in updateRoad():
   Find the section: `if (!state.skiEquipped && shopTimer > 0.4)`
   Add rental cost:
   ```javascript
   if (!state.skiEquipped && shopTimer > 0.4) {
     if (state.money >= 10) {
       state.money -= 10;  // Ski rental
       state.skiEquipped = true;
       playSkiEquipped();
       // ... rest of shop logic
     } else {
       setMessage("Need $10 for skis!");
     }
   }
   ```

3. GAME-04: 1000-point boundary bonus - add helper function and tracking:
   ```javascript
   let lastBonusThreshold = 0;  // Track last awarded bonus level

   function checkPointBonus() {
     const threshold = Math.floor(state.score / 1000) * 1000;
     if (threshold > lastBonusThreshold && threshold > 0) {
       state.money += 10;  // $10 bonus
       lastBonusThreshold = threshold;
       setMessage("$10 bonus!");
     }
   }
   ```

4. Call checkPointBonus() after any score increase:
   - After gate pass: `state.score += 30; checkPointBonus();`
   - After shop score: `state.score += 120 + bonus; checkPointBonus();`
   - After ski run complete: `state.score += 150; checkPointBonus();`

5. Reset lastBonusThreshold in resetGame():
   ```javascript
   lastBonusThreshold = 0;
   ```

6. Check for game over when money goes negative AND lives are 0:
   - Currently game over triggers on lives <= 0
   - Keep this behavior, money just adds economic pressure
  </action>
  <verify>
- Start game, verify $40
- Get hit by car, verify $30 and life lost
- Go to shop, verify $20 and skis equipped
- Score 1000 points, verify $30 bonus awarded
  </verify>
  <done>All money mechanics working: $10 ambulance, $10 rental, $10/1000pt bonus</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Game starts with $40
- [ ] HUD shows money amount
- [ ] Collision deducts $10
- [ ] Ski rental costs $10
- [ ] Cannot rent if money < $10
- [ ] $10 bonus at 1000, 2000, 3000... point thresholds
- [ ] Money resets to $40 on game restart
</verification>

<success_criteria>
- All tasks completed
- Money system fully functional
- Economic pressure creates authentic gameplay tension
</success_criteria>

<output>
After completion, create `.planning/phases/04-gameplay-timing/04-02-SUMMARY.md`
</output>
